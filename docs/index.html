<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSD2 API Discovery - Bank API Inventory</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>PSD2 API Discovery</h1>
            <p class="subtitle">Automated inventory of PSD2-compatible banking APIs</p>
        </header>

        <main>
            <!-- Data Status Section -->
            <section class="status-section">
                <div class="status-header">
                    <div class="last-updated">
                        <span class="status-label">Last Updated:</span>
                        <span id="last-updated-time">Loading...</span>
                    </div>
                    <div class="action-buttons">
                        <button type="button" class="btn-primary" onclick="loadData()" id="refresh-btn">
                            Refresh Data
                        </button>
                        <a href="https://github.com/XsionTrOLeT/APIDiscovery/actions/workflows/scrape.yml"
                           target="_blank"
                           rel="noopener"
                           class="btn-secondary">
                            Run Scan Now (GitHub Actions)
                        </a>
                    </div>
                </div>
                <p class="help-text">
                    Data is automatically updated hourly via GitHub Actions. Click "Run Scan Now" to trigger an immediate scan.
                </p>
            </section>

            <!-- Loading Section -->
            <section class="loading-section" id="loading-section">
                <div class="loading-spinner"></div>
                <p>Loading API inventory...</p>
            </section>

            <!-- Results Section -->
            <section class="results-section" id="results-section" style="display: none;">
                <div class="results-header">
                    <h2>API Inventory</h2>
                    <div class="export-buttons">
                        <button type="button" class="btn-export" onclick="exportJSON()">Export JSON</button>
                        <button type="button" class="btn-export" onclick="exportCSV()">Export CSV</button>
                    </div>
                </div>

                <!-- Summary Stats -->
                <div class="stats-grid" id="stats-grid">
                    <div class="stat-card">
                        <span class="stat-value" id="total-apis">0</span>
                        <span class="stat-label">APIs Found</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="total-sites">0</span>
                        <span class="stat-label">Sites Scanned</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="total-pages">0</span>
                        <span class="stat-label">Pages Analyzed</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="ais-count">0</span>
                        <span class="stat-label">AIS APIs</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="pis-count">0</span>
                        <span class="stat-label">PIS APIs</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="caf-count">0</span>
                        <span class="stat-label">CAF APIs</span>
                    </div>
                </div>

                <!-- Filter Controls -->
                <div class="filter-controls">
                    <input type="text" id="search-filter" placeholder="Search APIs..." oninput="filterResults()" />
                    <select id="type-filter" onchange="filterResults()">
                        <option value="">All Types</option>
                        <option value="AIS">AIS (Account Information)</option>
                        <option value="PIS">PIS (Payment Initiation)</option>
                        <option value="CAF">CAF (Confirmation of Funds)</option>
                        <option value="PSD2">PSD2 General</option>
                    </select>
                </div>

                <!-- API Table -->
                <div class="table-container">
                    <table class="api-table" id="api-table">
                        <thead>
                            <tr>
                                <th>Bank/Provider</th>
                                <th>API Type</th>
                                <th>Description</th>
                                <th>Documentation</th>
                                <th>Confidence</th>
                                <th>Source</th>
                            </tr>
                        </thead>
                        <tbody id="api-table-body">
                        </tbody>
                    </table>
                </div>

                <!-- Scan Details -->
                <div class="scan-details" id="scan-details">
                    <h3>Scan Details</h3>
                    <div id="scan-details-content"></div>
                </div>

                <!-- Scan Logs -->
                <div class="scan-logs" id="scan-logs-section">
                    <div class="scan-logs-header">
                        <h3>Last Scan Logs</h3>
                        <button type="button" class="btn-toggle" onclick="toggleLogs()" id="toggle-logs-btn">Show Logs</button>
                    </div>
                    <div class="scan-logs-content collapsed" id="scan-logs-content"></div>
                </div>

                <!-- Raw Captured Content (Debug) -->
                <div class="raw-content-section" id="raw-content-section">
                    <div class="scan-logs-header">
                        <h3>Raw Captured Content (Debug)</h3>
                        <button type="button" class="btn-toggle" onclick="toggleRawContent()" id="toggle-raw-btn">Show Raw Content</button>
                    </div>
                    <div class="raw-content-container collapsed" id="raw-content-container"></div>
                </div>
            </section>

            <!-- Empty State Section -->
            <section class="empty-section" id="empty-section" style="display: none;">
                <h2>No APIs Found Yet</h2>
                <p class="help-text">
                    The API inventory is empty. Click "Run Scan Now" to trigger the first scan,
                    or wait for the scheduled hourly scan to run.
                </p>
                <a href="https://github.com/XsionTrOLeT/APIDiscovery/actions/workflows/scrape.yml"
                   target="_blank"
                   rel="noopener"
                   class="btn-primary">
                    Run Scan Now
                </a>
            </section>

            <!-- Error Section -->
            <section class="error-section" id="error-section" style="display: none;">
                <h2>Error Loading Data</h2>
                <p class="error-message" id="error-message"></p>
                <button type="button" class="btn-secondary" onclick="loadData()">Try Again</button>
            </section>
        </main>

        <footer>
            <p>PSD2 API Discovery Tool - For compliance research and API inventory management</p>
        </footer>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
